<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Gate â€“ Scratch Event</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #000;
  color: #ffd700;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  text-align: center;
}
.card {
  width: 360px;
  background: rgba(20,20,20,0.8);
  padding: 30px;
  border-radius: 20px;
  border: 2px solid #d4af37;
  box-shadow: 0 0 20px rgba(255,215,0,0.3);
}
input {
  width: 90%;
  padding: 12px;
  border: 1px solid #d4af37;
  background: rgba(30,30,30,0.9);
  color: #ffd700;
  border-radius: 12px;
  margin-top: 12px;
}
button {
  width: 90%;
  padding: 14px;
  margin-top: 15px;
  border: none;
  background: linear-gradient(135deg,#d4af37,#ffdf70);
  color: #000;
  font-size: 16px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: .25s;
}
button:hover {
  transform: scale(1.03);
}
#error {
  margin-top: 15px;
  color: #ff5656;
  font-weight: 600;
}
#success {
  margin-top: 15px;
  color: #7dff7d;
  font-weight: 600;
}
</style>
</head>
<body>

<div class="card">
  <h2>ðŸŽŸ Scratch Event â€“ Player Gate</h2>
  <p>Enter Your Access Code</p>

  <input type="text" id="playerCode" placeholder="Enter code here">
  <button onclick="verifyCode()">Enter Game</button>

  <div id="error"></div>
  <div id="success"></div>
</div>

<script>
// ================================
// CONFIG â€“ Ganti sesuai repo kamu
// ================================
const JSON_URL = "https://raw.githubusercontent.com/USERNAME/REPO/main/scratch_codes.json";

// Dari admin generator
// window.markCodeUsedAPI(code) <-- otomatis terhubung jika file berada di domain yang sama
// Jika tidak, replace dengan API webhook sendiri

// ================================
// MAIN FUNCTION
// ================================
async function verifyCode(){
  const input = document.getElementById("playerCode").value.trim().toUpperCase();
  document.getElementById("error").innerHTML = "";
  document.getElementById("success").innerHTML = "";

  if(!input){
    showError("Please enter your access code!");
    return;
  }

  let data;
  try {
    const req = await fetch(JSON_URL + "?t=" + Date.now());
    data = await req.json();
  } catch {
    showError("Failed loading player code database!");
    return;
  }

  const found = data.find(c => c.code === input);

  if(!found){
    showError("âŒ Code Not Found");
    return;
  }
  if(found.used){
    showError("âš ï¸ Code Already Used");
    return;
  }

  // Valid â†’ mark used via admin generator API
  if(typeof window.markCodeUsedAPI === "function"){
    const result = await window.markCodeUsedAPI(input);
    if(!result){
      showError("âš ï¸ Failed to update status. Try again.");
      return;
    }
  }

  // SUCCESS
  document.getElementById("success").innerHTML = "âœ… Code Accepted! Redirecting...";

  setTimeout(()=>{
    window.location.href = "scratch-game.html"; 
    // GANTI dengan link scratch game kamu
  }, 1000);
}

// Helper UI
function showError(msg){
  document.getElementById("error").innerHTML = msg;
}
</script>

</body>
</html>
